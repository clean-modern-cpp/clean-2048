#include <doctest/doctest.h>

#include <string>

#include "BoardView.h"

TEST_CASE("Body of empty board") {
  console_ui::BoardView boardView;
  boardView.initWithDimension(4, 4);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------

)");
}

TEST_CASE("Body after initWithDimension") {
  console_ui::BoardView boardView;
  boardView.initWithDimension(4, 4);
  boardView.present({
      {},
      {},
      {
          {{1, 1}, 2},
      },
  });
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |     2 |       |       |
---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------

)");

  boardView.initWithDimension(4, 4);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |       |
---------------------------------

)");
}

TEST_CASE("Body of new actions") {
  console_ui::BoardView boardView;
  boardView.initWithDimension(4, 4);
  common::Actions newActions{
      {},
      {},
      {
          {{1, 1}, 2},
          {{2, 2}, 4},
      },
  };
  boardView.present(newActions);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |     2 |       |       |
---------------------------------
|       |       |     4 |       |
---------------------------------
|       |       |       |       |
---------------------------------

)");
}

TEST_CASE("Body of move actions") {
  console_ui::BoardView boardView;
  boardView.initWithDimension(4, 4);
  common::Actions newActions{
      {},
      {},
      {
          {{1, 1}, 2},
          {{2, 2}, 4},
      },
  };
  boardView.present(newActions);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |     2 |       |       |
---------------------------------
|       |       |     4 |       |
---------------------------------
|       |       |       |       |
---------------------------------

)");

  common::Actions moveActions{
      {
          {{1, 1}, {1, 3}},
          {{2, 2}, {2, 3}},
      },
      {},
      {},
  };
  boardView.present(moveActions);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |       |     2 |       |
---------------------------------
|       |       |       |     4 |
---------------------------------
|       |       |       |       |
---------------------------------

---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |     2 |
---------------------------------
|       |       |       |     4 |
---------------------------------
|       |       |       |       |
---------------------------------

)");
}

TEST_CASE("Body of move, new and merge actions") {
  console_ui::BoardView boardView;
  boardView.initWithDimension(4, 4);
  common::Actions newActions{
      {},
      {},
      {
          {{1, 1}, 2},
          {{1, 3}, 2},
          {{2, 2}, 4},
      },
  };
  boardView.present(newActions);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |     2 |       |     2 |
---------------------------------
|       |       |     4 |       |
---------------------------------
|       |       |       |       |
---------------------------------

)");

  common::Actions actions{
      {
          {{1, 1}, {1, 3}},
          {{2, 2}, {2, 3}},
      },
      {
          {{1, 3}, 4},
      },
      {
          {{1, 0}, 4},
      },
  };
  boardView.present(actions);
  REQUIRE_EQ(boardView.body(), R"(---------------------------------
|       |       |       |       |
---------------------------------
|       |       |     2 |     2 |
---------------------------------
|       |       |       |     4 |
---------------------------------
|       |       |       |       |
---------------------------------

---------------------------------
|       |       |       |       |
---------------------------------
|       |       |       |     2 |
---------------------------------
|       |       |       |     4 |
---------------------------------
|       |       |       |       |
---------------------------------

---------------------------------
|       |       |       |       |
---------------------------------
|     4 |       |       |     4 |
---------------------------------
|       |       |       |     4 |
---------------------------------
|       |       |       |       |
---------------------------------

)");
}
